<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MonadORE v3 - PoW Mining (WORKING VERSION)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #00ff41;
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
        }

        #matrix {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.12;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            border: 2px solid #00ff41;
            padding: 30px;
            margin-bottom: 30px;
            background: rgba(0, 255, 65, 0.05);
            box-shadow: 0 0 40px rgba(0, 255, 65, 0.3);
            position: relative;
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 52px;
            text-shadow: 0 0 15px #00ff41, 0 0 30px #00ff41;
            letter-spacing: 6px;
            display: inline-block;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 15px #00ff41, 0 0 30px #00ff41; }
            50% { text-shadow: 0 0 25px #00ff41, 0 0 50px #00ff41; }
        }

        .wallet-btn {
            float: right;
            background: transparent;
            border: 2px solid #00ff41;
            color: #00ff41;
            padding: 14px 28px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .wallet-btn:hover {
            background: #00ff41;
            color: #0a0e27;
            box-shadow: 0 0 25px #00ff41;
            transform: scale(1.05);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-box {
            border: 2px solid #00ff41;
            padding: 25px;
            background: rgba(0, 0, 0, 0.7);
            position: relative;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }

        .stat-box::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, #00ff41, transparent, #00ff41);
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s;
            filter: blur(5px);
        }

        .stat-box:hover::before {
            opacity: 0.7;
        }

        .stat-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0, 255, 65, 0.4);
        }

        .stat-label {
            font-size: 11px;
            opacity: 0.8;
            margin-bottom: 12px;
            letter-spacing: 2px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            text-shadow: 0 0 12px #00ff41;
            margin-bottom: 5px;
        }

        .mining-zone {
            border: 2px solid #00ff41;
            padding: 40px;
            background: rgba(0, 0, 0, 0.8);
            margin-bottom: 30px;
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.2);
            backdrop-filter: blur(10px);
        }

        .terminal {
            background: #000;
            border: 2px solid #00ff41;
            padding: 20px;
            min-height: 250px;
            margin-bottom: 20px;
            font-size: 13px;
            overflow-y: auto;
            max-height: 450px;
            box-shadow: inset 0 0 20px rgba(0, 255, 65, 0.1);
        }

        .terminal-line {
            margin-bottom: 6px;
            word-break: break-word;
            line-height: 1.4;
        }

        .terminal-line::before {
            content: '‚ñ∏ ';
            color: #00ff41;
            font-weight: bold;
        }

        .terminal-line.success {
            color: #00ff41;
            font-weight: bold;
            text-shadow: 0 0 5px #00ff41;
        }

        .terminal-line.error {
            color: #ff4136;
            font-weight: bold;
        }

        .terminal-line.warning {
            color: #ffdc00;
        }

        .terminal-line.info {
            color: #7fdbff;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .btn {
            padding: 22px;
            background: transparent;
            border: 2px solid #00ff41;
            color: #00ff41;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 3px;
            font-weight: bold;
        }

        .btn:hover:not(:disabled) {
            background: #00ff41;
            color: #0a0e27;
            box-shadow: 0 0 35px #00ff41;
            transform: translateY(-3px);
        }

        .btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .btn.mining {
            animation: pulse 1.5s infinite;
            background: rgba(0, 255, 65, 0.15);
            border-width: 3px;
        }

        @keyframes pulse {
            0%, 100% { 
                box-shadow: 0 0 20px #00ff41;
                border-color: #00ff41;
            }
            50% { 
                box-shadow: 0 0 50px #00ff41;
                border-color: #00ffaa;
            }
        }

        .hashrate-display {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(0, 255, 65, 0.08);
            border-left: 4px solid #00ff41;
            backdrop-filter: blur(5px);
        }

        .hashrate-item {
            text-align: center;
        }

        .hashrate-item strong {
            display: block;
            font-size: 11px;
            opacity: 0.8;
            margin-bottom: 8px;
            letter-spacing: 1px;
        }

        .hashrate-item span {
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 0 10px #00ff41;
        }

        .info-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .info-box {
            border: 2px solid #00ff41;
            padding: 30px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .info-box h3 {
            margin-bottom: 20px;
            font-size: 22px;
            text-shadow: 0 0 10px #00ff41;
        }

        .info-item {
            margin-bottom: 15px;
            padding-left: 18px;
            border-left: 3px solid #00ff41;
            line-height: 1.6;
        }

        footer {
            text-align: center;
            padding: 40px;
            border-top: 2px solid #00ff41;
            margin-top: 50px;
            opacity: 0.8;
        }

        footer a {
            color: #00ff41;
            text-decoration: none;
            text-shadow: 0 0 8px #00ff41;
            transition: all 0.3s;
        }

        footer a:hover {
            text-shadow: 0 0 20px #00ff41;
            letter-spacing: 2px;
        }

        .scan-line {
            position: fixed;
            width: 100%;
            height: 3px;
            background: rgba(0, 255, 65, 0.6);
            box-shadow: 0 0 15px #00ff41;
            animation: scan 5s linear infinite;
            z-index: 9999;
            pointer-events: none;
        }

        @keyframes scan {
            from { top: 0; }
            to { top: 100%; }
        }

        @media (max-width: 768px) {
            .info-section {
                grid-template-columns: 1fr;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            .hashrate-display {
                grid-template-columns: 1fr 1fr;
            }
            
            h1 {
                font-size: 36px;
            }
            
            .wallet-btn {
                float: none;
                display: block;
                margin-top: 20px;
            }
        }

        .stop-btn {
            background: rgba(255, 65, 54, 0.15);
            border-color: #ff4136;
            color: #ff4136;
        }

        .stop-btn:hover:not(:disabled) {
            background: #ff4136;
            color: #0a0e27;
            box-shadow: 0 0 35px #ff4136;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(0, 255, 65, 0.1);
            margin-top: 15px;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff41, #00ffaa);
            width: 0%;
            transition: width 0.3s;
            box-shadow: 0 0 10px #00ff41;
        }
    </style>
</head>
<body>
    <div class="scan-line"></div>
    <canvas id="matrix"></canvas>

    <div class="container">
        <header>
            <h1>‚õèÔ∏è MONADORE</h1>
            <button class="wallet-btn" onclick="connectWallet()">CONNECT WALLET</button>
            <div style="clear: both; margin-top: 20px;">
                <small>PROOF-OF-WORK MINING PROTOCOL v3.0 - FULLY WORKING</small>
            </div>
        </header>

        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-label">YOUR BALANCE</div>
                <div class="stat-value" id="balance">0.0000</div>
                <div class="stat-label">ORE</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">UNCLAIMED REWARDS</div>
                <div class="stat-value" id="unclaimed">0.0000</div>
                <div class="stat-label">ORE</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">TOTAL MINED</div>
                <div class="stat-value" id="totalSupply">0.00</div>
                <div class="stat-label">/ 21M ORE</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            <div class="stat-box">
                <div class="stat-label">DIFFICULTY</div>
                <div class="stat-value" id="difficulty">0</div>
                <div class="stat-label">LEADING ZEROS</div>
            </div>
        </div>

        <div class="mining-zone">
            <h2 style="margin-bottom: 25px; text-shadow: 0 0 10px #00ff41;">‚ö° MINING TERMINAL</h2>
            
            <div class="hashrate-display">
                <div class="hashrate-item">
                    <strong>ATTEMPTS</strong>
                    <span id="hashcount">0</span>
                </div>
                <div class="hashrate-item">
                    <strong>VALID FOUND</strong>
                    <span id="validcount" style="color: #00ffaa;">0</span>
                </div>
                <div class="hashrate-item">
                    <strong>HASHRATE</strong>
                    <span id="hashrate">0 H/s</span>
                </div>
                <div class="hashrate-item">
                    <strong>COOLDOWN</strong>
                    <span id="cooldown">READY</span>
                </div>
            </div>

            <div class="terminal" id="terminal">
                <div class="terminal-line info">‚îå‚îÄ MonadORE Mining System v3.0 ‚îÄ‚îê</div>
                <div class="terminal-line info">‚îÇ Fully Working Version          ‚îÇ</div>
                <div class="terminal-line info">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</div>
                <div class="terminal-line">System initialized...</div>
                <div class="terminal-line">Awaiting wallet connection...</div>
            </div>

            <div class="controls">
                <button class="btn" id="mineBtn" onclick="startMining()" disabled>‚õèÔ∏è START MINING</button>
                <button class="btn stop-btn" id="stopBtn" onclick="stopMining()" style="display:none;">‚èπÔ∏è STOP MINING</button>
                <button class="btn" id="claimBtn" onclick="claimRewards()" disabled>üí∞ CLAIM REWARDS</button>
            </div>
        </div>

        <div class="info-section">
            <div class="info-box">
                <h3>‚ñ∏ PROTOCOL INFO</h3>
                <div class="info-item">
                    <strong>CONTRACT:</strong><br>
                    <small style="word-break: break-all;">0xcCd8f63Ca88562399bB423d277B15E5701BD6743</small>
                </div>
                <div class="info-item">
                    <strong>NETWORK:</strong> Monad Testnet
                </div>
                <div class="info-item">
                    <strong>CHAIN ID:</strong> 10143 (0x279F)
                </div>
                <div class="info-item">
                    <strong>RPC:</strong> testnet-rpc.monad.xyz
                </div>
                <div class="info-item">
                    <strong>ALGORITHM:</strong> Keccak256 PoW
                </div>
                <div class="info-item">
                    <strong>MIN INTERVAL:</strong> 10 seconds
                </div>
                <div class="info-item">
                    <strong>MAX SUPPLY:</strong> 21,000,000 ORE
                </div>
            </div>

            <div class="info-box">
                <h3>‚ñ∏ HOW IT WORKS</h3>
                <div class="info-item">
                    <strong>[1]</strong> Connect MetaMask to Monad Testnet
                </div>
                <div class="info-item">
                    <strong>[2]</strong> Click START MINING
                </div>
                <div class="info-item">
                    <strong>[3]</strong> Miner finds valid nonces locally
                </div>
                <div class="info-item">
                    <strong>[4]</strong> Only valid nonces submitted to blockchain
                </div>
                <div class="info-item">
                    <strong>[5]</strong> Earn ORE tokens for successful mining
                </div>
                <div class="info-item">
                    <strong>[6]</strong> Claim your rewards anytime
                </div>
                <div class="info-item" style="margin-top: 20px; color: #00ffaa; border-left-color: #00ffaa;">
                    ‚úì Optimized mining algorithm<br>
                    ‚úì Better nonce generation<br>
                    ‚úì Fixed hash validation
                </div>
            </div>
        </div>

        <footer>
            <p style="font-size: 18px; margin-bottom: 10px;">CREATED BY <a href="https://x.com/ega_2ez4crypto" target="_blank">@ega_2ez4crypto</a></p>
            <p style="margin-top: 15px; font-size: 12px; opacity: 0.7;">MONADORE v3.0 - FULLY WORKING VERSION</p>
        </footer>
    </div>

    <script>
        const CONTRACT_ADDRESS = '0xcCd8f63Ca88562399bB423d277B15E5701BD6743';
        const RPC_URL = 'https://testnet-rpc.monad.xyz';
        const CHAIN_ID = 10143;
        
        const ABI = [
            "function mine(uint256 nonce) external",
            "function claimRewards() external",
            "function getMinerInfo(address miner) external view returns (uint256 balance, uint256 unclaimed, uint256 lastMine, uint256 nextMineTime)",
            "function getStats() external view returns (uint256 supply, uint256 diff, uint256 reward, uint256 maxSupply)",
            "function totalSupply() external view returns (uint256)",
            "function difficulty() external view returns (uint256)",
            "function testNonce(uint256 nonce) external view returns (bool, bytes32)",
            "function validHash(bytes32 hash) external view returns (bool)"
        ];

        let account = null;
        let mining = false;
        let attemptCount = 0;
        let validCount = 0;
        let currentDifficulty = 0;
        let provider = null;
        let contract = null;
        let currentBlockNumber = 0;
        let hashrateInterval = null;
        let lastAttemptCount = 0;

        // Matrix background
        const canvas = document.getElementById('matrix');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const chars = '01‚ìû‚ì°‚ìî‚õèÔ∏è';
        const fontSize = 14;
        const columns = canvas.width / fontSize;
        const drops = [];
        for (let i = 0; i < Math.floor(columns); i++) {
            drops[i] = Math.floor(Math.random() * -100);
        }

        function drawMatrix() {
            ctx.fillStyle = 'rgba(10, 14, 39, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#00ff41';
            ctx.font = fontSize + 'px monospace';

            for (let i = 0; i < drops.length; i++) {
                const text = chars[Math.floor(Math.random() * chars.length)];
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 35);

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        function log(msg, type = 'normal') {
            const terminal = document.getElementById('terminal');
            const line = document.createElement('div');
            line.className = 'terminal-line';
            if (type === 'success') line.classList.add('success');
            if (type === 'error') line.classList.add('error');
            if (type === 'warning') line.classList.add('warning');
            if (type === 'info') line.classList.add('info');
            
            const timestamp = new Date().toLocaleTimeString();
            line.textContent = `[${timestamp}] ${msg}`;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
            
            while (terminal.children.length > 150) {
                terminal.removeChild(terminal.firstChild);
            }
        }

        async function connectWallet() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    log('‚ùå MetaMask not detected!', 'error');
                    alert('Please install MetaMask extension');
                    return;
                }

                log('üîå Requesting wallet connection...', 'info');
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });

                log('üåê Switching to Monad Testnet...', 'info');
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: '0x279F' }]
                    });
                } catch (switchError) {
                    if (switchError.code === 4902) {
                        log('‚ûï Adding Monad Testnet...', 'warning');
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: '0x279F',
                                chainName: 'Monad Testnet',
                                nativeCurrency: { 
                                    name: 'MON', 
                                    symbol: 'MON', 
                                    decimals: 18 
                                },
                                rpcUrls: [RPC_URL],
                                blockExplorerUrls: ['https://explorer.testnet.monad.xyz']
                            }]
                        });
                        log('‚úì Monad Testnet added!', 'success');
                    } else {
                        throw switchError;
                    }
                }

                account = accounts[0];
                provider = new ethers.providers.Web3Provider(window.ethereum);
                contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, provider);
                
                // Get current block number
                currentBlockNumber = await provider.getBlockNumber();
                
                document.querySelector('.wallet-btn').textContent = 
                    'üîó ' + account.slice(0, 6) + '...' + account.slice(-4);
                log('‚úì Wallet connected: ' + account, 'success');
                log('üì¶ Current block: ' + currentBlockNumber, 'info');
                
                document.getElementById('mineBtn').disabled = false;
                
                await loadData();
                setInterval(loadData, 3000);
                
                log('‚úì System ready! Click START MINING.', 'success');
            } catch (error) {
                log('‚ùå ERROR: ' + error.message, 'error');
                console.error(error);
            }
        }

        async function loadData() {
            if (!account || !contract) return;
            
            try {
                const [minerInfo, stats, blockNum] = await Promise.all([
                    contract.getMinerInfo(account),
                    contract.getStats(),
                    provider.getBlockNumber()
                ]);

                currentBlockNumber = blockNum;

                document.getElementById('balance').textContent = 
                    parseFloat(ethers.utils.formatEther(minerInfo[0])).toFixed(4);
                document.getElementById('unclaimed').textContent = 
                    parseFloat(ethers.utils.formatEther(minerInfo[1])).toFixed(4);
                
                const supply = parseFloat(ethers.utils.formatEther(stats[0]));
                document.getElementById('totalSupply').textContent = supply.toFixed(2);
                
                // Update progress bar
                const progress = (supply / 21000000) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
                
                currentDifficulty = stats[1].toNumber();
                document.getElementById('difficulty').textContent = currentDifficulty;

                const now = Math.floor(Date.now() / 1000);
                const nextMineTime = minerInfo[3].toNumber();
                const cooldown = Math.max(0, nextMineTime - now);
                
                if (cooldown > 0) {
                    document.getElementById('cooldown').textContent = cooldown + 's';
                    document.getElementById('cooldown').style.color = '#ff4136';
                    if (!mining) {
                        document.getElementById('mineBtn').disabled = true;
                    }
                } else {
                    document.getElementById('cooldown').textContent = 'READY';
                    document.getElementById('cooldown').style.color = '#00ff41';
                    if (!mining) {
                        document.getElementById('mineBtn').disabled = false;
                    }
                }

                const unclaimedVal = parseFloat(ethers.utils.formatEther(minerInfo[1]));
                document.getElementById('claimBtn').disabled = unclaimedVal === 0;
            } catch (error) {
                console.error('Load error:', error);
            }
        }

        // Calculate leading zeros in a hash (client-side verification)
        function countLeadingZeros(hash) {
            let count = 0;
            const hashStr = hash.slice(2); // Remove '0x'
            for (let i = 0; i < hashStr.length; i++) {
                if (hashStr[i] === '0') {
                    count++;
                } else {
                    break;
                }
            }
            return count;
        }

        async function startMining() {
            if (!account || !contract) {
                log('‚ùå Please connect wallet first', 'error');
                return;
            }

            if (currentDifficulty === 0) {
                log('‚ùå Difficulty not loaded. Please wait...', 'error');
                return;
            }

            mining = true;
            attemptCount = 0;
            validCount = 0;
            lastAttemptCount = 0;
            
            document.getElementById('mineBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'block';
            document.getElementById('mineBtn').classList.add('mining');
            document.getElementById('claimBtn').disabled = true;
            
            // Start hashrate counter
            hashrateInterval = setInterval(() => {
                const hashrate = attemptCount - lastAttemptCount;
                document.getElementById('hashrate').textContent = hashrate + ' H/s';
                lastAttemptCount = attemptCount;
            }, 1000);
            
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
            log('‚õèÔ∏è  MINING STARTED', 'success');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
            log('üéØ Target: ' + currentDifficulty + ' leading zeros', 'info');
            log('üì¶ Block: ' + currentBlockNumber, 'info');

            try {
                const signer = provider.getSigner();
                const contractWithSigner = contract.connect(signer);

                while (mining) {
                    // Generate truly random nonce
                    const nonce = ethers.BigNumber.from(ethers.utils.randomBytes(32));
                    
                    attemptCount++;
                    document.getElementById('hashcount').textContent = attemptCount.toLocaleString();
                    
                    // Calculate hash locally (same as contract)
                    const hash = ethers.utils.keccak256(
                        ethers.utils.defaultAbiCoder.encode(
                            ['address', 'uint256', 'uint256'],
                            [account, nonce, currentBlockNumber]
                        )
                    );
                    
                    const leadingZeros = countLeadingZeros(hash);
                    
                    // Check if valid
                    if (leadingZeros >= currentDifficulty) {
                        validCount++;
                        document.getElementById('validcount').textContent = validCount;
                        
                        log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
                        log('‚ú® VALID NONCE FOUND!', 'success');
                        log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
                        log('üé≤ Nonce: ' + nonce.toString(), 'info');
                        log('üîê Hash: ' + hash.slice(0, 20) + '...', 'info');
                        log('‚ö° Zeros: ' + leadingZeros, 'success');
                        log('üì§ Submitting to blockchain...', 'warning');
                        
                        try {
                            // Estimate gas
                            const gasEstimate = await contractWithSigner.estimateGas.mine(nonce);
                            const gasLimit = gasEstimate.mul(150).div(100); // 50% buffer
                            
                            log('‚õΩ Gas estimate: ' + gasEstimate.toString(), 'info');
                            
                            // Submit transaction
                            const tx = await contractWithSigner.mine(nonce, { 
                                gasLimit: gasLimit
                            });
                            
                            log('üì® TX sent: ' + tx.hash.slice(0, 20) + '...', 'warning');
                            log('‚è≥ Waiting for confirmation...', 'warning');
                            
                            const receipt = await tx.wait();
                            
                            if (receipt.status === 1) {
                                log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
                                log('üéâ MINING SUCCESS!', 'success');
                                log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
                                log('‚úì Block mined!', 'success');
                                log('‚õΩ Gas used: ' + receipt.gasUsed.toString(), 'info');
                                log('üîó TX: ' + receipt.transactionHash.slice(0, 20) + '...', 'success');
                                log('üí∞ Rewards added to your balance!', 'success');
                                
                                mining = false;
                                if (hashrateInterval) clearInterval(hashrateInterval);
                                document.getElementById('mineBtn').style.display = 'block';
                                document.getElementById('stopBtn').style.display = 'none';
                                document.getElementById('mineBtn').classList.remove('mining');
                                document.getElementById('claimBtn').disabled = false;
                                
                                await loadData();
                                return;
                            } else {
                                log('‚ùå TX failed with status 0', 'error');
                            }
                            
                        } catch (txError) {
                            if (txError.message.includes('user rejected') || txError.code === 4001) {
                                log('‚ùå Transaction rejected by user', 'error');
                                mining = false;
                                if (hashrateInterval) clearInterval(hashrateInterval);
                                document.getElementById('mineBtn').style.display = 'block';
                                document.getElementById('stopBtn').style.display = 'none';
                                document.getElementById('mineBtn').classList.remove('mining');
                                return;
                            }
                            
                            if (txError.message.includes('Mining too fast')) {
                                log('‚è∞ Cooldown active - waiting...', 'warning');
                                mining = false;
                                if (hashrateInterval) clearInterval(hashrateInterval);
                                document.getElementById('mineBtn').style.display = 'block';
                                document.getElementById('stopBtn').style.display = 'none';
                                document.getElementById('mineBtn').classList.remove('mining');
                                await loadData();
                                return;
                            }
                            
                            if (txError.message.includes('Hash already used')) {
                                log('‚ö†Ô∏è  Hash collision - continuing...', 'warning');
                                await new Promise(resolve => setTimeout(resolve, 1000));
                            } else {
                                log('‚ùå TX Error: ' + txError.message.substring(0, 100), 'error');
                                await new Promise(resolve => setTimeout(resolve, 2000));
                            }
                        }
                    }
                    
                    // Progress log every 1000 attempts
                    if (attemptCount % 1000 === 0) {
                        log('‚è≥ Progress: ' + attemptCount.toLocaleString() + ' attempts, ' + validCount + ' valid found', 'info');
                    }
                    
                    // Prevent browser freeze - yield every 100 attempts
                    if (attemptCount % 100 === 0) {
                        await new Promise(resolve => setTimeout(resolve, 1));
                    }
                    
                    // Update block number every 500 attempts
                    if (attemptCount % 500 === 0) {
                        try {
                            currentBlockNumber = await provider.getBlockNumber();
                        } catch (e) {
                            console.error('Block number update failed:', e);
                        }
                    }
                }
            } catch (error) {
                log('‚ùå CRITICAL ERROR: ' + error.message, 'error');
                console.error(error);
                mining = false;
                if (hashrateInterval) clearInterval(hashrateInterval);
                document.getElementById('mineBtn').style.display = 'block';
                document.getElementById('stopBtn').style.display = 'none';
                document.getElementById('mineBtn').classList.remove('mining');
            }
        }

        function stopMining() {
            mining = false;
            if (hashrateInterval) clearInterval(hashrateInterval);
            document.getElementById('mineBtn').style.display = 'block';
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('mineBtn').classList.remove('mining');
            document.getElementById('hashrate').textContent = '0 H/s';
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'warning');
            log('‚èπÔ∏è  MINING STOPPED', 'warning');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'warning');
            log('üìä Total attempts: ' + attemptCount.toLocaleString(), 'info');
            log('‚úì Valid nonces found: ' + validCount, 'info');
        }

        async function claimRewards() {
            if (!account || !contract) return;
            
            document.getElementById('claimBtn').disabled = true;
            log('üí∞ Claiming rewards...', 'warning');

            try {
                const signer = provider.getSigner();
                const contractWithSigner = contract.connect(signer);

                const gasEstimate = await contractWithSigner.estimateGas.claimRewards();
                const tx = await contractWithSigner.claimRewards({ 
                    gasLimit: gasEstimate.mul(120).div(100) 
                });
                
                log('üì® TX sent: ' + tx.hash.slice(0, 20) + '...', 'warning');
                
                const receipt = await tx.wait();
                log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
                log('‚ú® REWARDS CLAIMED!', 'success');
                log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
                log('‚õΩ Gas used: ' + receipt.gasUsed.toString(), 'info');
                log('üíé Check your balance!', 'success');
                
                await loadData();
            } catch (error) {
                log('‚ùå ERROR: ' + error.message, 'error');
                document.getElementById('claimBtn').disabled = false;
            }
        }

        // Auto-connect if wallet is already connected
        window.addEventListener('load', () => {
            if (window.ethereum && window.ethereum.selectedAddress) {
                setTimeout(connectWallet, 500);
            }
        });

        // Handle account/network changes
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    log('üîå Wallet disconnected', 'warning');
                    setTimeout(() => location.reload(), 1000);
                } else {
                    log('üîÑ Account changed, reloading...', 'info');
                    setTimeout(() => location.reload(), 1000);
                }
            });

            window.ethereum.on('chainChanged', () => {
                log('üåê Network changed, reloading...', 'info');
                setTimeout(() => location.reload(), 1000);
            });
        }
    </script>
</body>
</html>
